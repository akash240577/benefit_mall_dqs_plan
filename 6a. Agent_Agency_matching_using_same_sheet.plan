<?xml version='1.0' encoding='UTF-8'?>
<purity-config version="10.6.2.ga-2017-03-03">
	<references/>
	<component-mappings>
		<propertyMappings/>
	</component-mappings>

<!-- (Filter Agency) --><step id="Filter Agency" className="com.ataccama.dqc.tasks.conditions.Filter" disabled="false" mode="NORMAL">
		<properties condition="AccountRecordType=&#39;Agency&#39;"/>
		<visual-constraints bounds="336,288,-1,-1" layout="vertical"/>
	</step>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="Filter Agency" endpoint="out"/>
		<target step="Multiplicator 2" endpoint="in"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>



<!-- (Filter_Agents_without_Agency) --><step id="Filter_Agents_without_Agency" className="com.ataccama.dqc.tasks.conditions.Filter" disabled="false" mode="NORMAL">
		<properties>
			<condition>AccountRecordType == &quot;Agent&quot; 
and (ParentAccountId is null or ParentAccountId == &quot;&quot;)</condition>
		</properties>
		<visual-constraints bounds="72,312,-1,-1" layout="vertical"/>
	</step>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="Filter_Agents_without_Agency" endpoint="out"/>
		<target step="match ein" endpoint="in_left"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>



<!-- (Match  phone) --><step id="Match  phone" className="com.ataccama.dqc.tasks.merge.Join" disabled="false" mode="NORMAL">
		<properties leftKey="std_Phone" matchStrategy="MERGE" rightKey="std_Phone" joinType="LEFT">
			<columnDefinitions>
				<columnDefinition expression="in_left.SalesforceId" name="SalesforceId"/>
				<columnDefinition expression="in_left.Email__c" name="Email__c"/>
				<columnDefinition expression="in_left.Phone" name="Phone"/>
				<columnDefinition expression="in_left.Mobile__c" name="Mobile__c"/>
				<columnDefinition expression="in_left.Fax" name="Fax"/>
				<columnDefinition expression="in_right.SalesforceId" name="ParentAccountId_phone"/>
				<columnDefinition expression="in_left.ParentAccountId_Fax" name="ParentAccountId_Fax"/>
				<columnDefinition expression="in_left.ParentAccountId_EIN" name="ParentAccountId_EIN"/>
				<columnDefinition expression="in_left.std_EIN" name="std_EIN"/>
				<columnDefinition expression="in_left.std_Phone" name="std_Phone"/>
				<columnDefinition expression="in_left.std_Fax" name="std_Fax"/>
				<columnDefinition expression="in_left.std_email" name="std_email"/>
			</columnDefinitions>
		</properties>
		<visual-constraints bounds="72,528,-1,-1" layout="vertical"/>
	</step>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="Match  phone" endpoint="out"/>
		<target step="Match Email" endpoint="in_left"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>



<!-- (Match Email) --><step id="Match Email" className="com.ataccama.dqc.tasks.merge.Join" disabled="false" mode="NORMAL">
		<properties leftKey="Email__c" matchStrategy="MERGE" rightKey="Email__c" joinType="LEFT">
			<columnDefinitions>
				<columnDefinition expression="in_left.SalesforceId" name="SalesforceId"/>
				<columnDefinition expression="in_left.Email__c" name="Email__c"/>
				<columnDefinition expression="in_left.Phone" name="Phone"/>
				<columnDefinition expression="in_left.Mobile__c" name="Mobile__c"/>
				<columnDefinition expression="in_left.Fax" name="Fax"/>
				<columnDefinition expression="in_left.ParentAccountId_EIN" name="ParentAccountId_EIN"/>
				<columnDefinition expression="in_right.SalesforceId" name="ParentAccountId_email"/>
				<columnDefinition expression="in_left.ParentAccountId_phone" name="ParentAccountId_phone"/>
				<columnDefinition expression="in_left.ParentAccountId_Fax" name="ParentAccountId_Fax"/>
				<columnDefinition expression="in_left.std_email" name="std_email"/>
			</columnDefinitions>
		</properties>
		<visual-constraints bounds="72,624,-1,-1" layout="vertical"/>
	</step>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="Match Email" endpoint="out"/>
		<target step="out" endpoint="in"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>



<!-- (Multiplicator) --><step id="Multiplicator" className="com.ataccama.dqc.tasks.flow.Multiplicator" disabled="false" mode="NORMAL">
		<properties/>
		<visual-constraints bounds="72,192,-1,-1" layout="vertical"/>
	</step>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="Multiplicator" endpoint="out"/>
		<target step="Filter Agency" endpoint="in"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="Multiplicator" endpoint="out"/>
		<target step="Filter_Agents_without_Agency" endpoint="in"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>



<!-- (Multiplicator 2) --><step id="Multiplicator 2" className="com.ataccama.dqc.tasks.flow.Multiplicator" disabled="false" mode="NORMAL">
		<properties/>
		<visual-constraints bounds="336,480,-1,-1" layout="vertical"/>
	</step>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="Multiplicator 2" endpoint="out"/>
		<target step="Match  phone" endpoint="in_right"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="Multiplicator 2" endpoint="out"/>
		<target step="Match Email" endpoint="in_right"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="Multiplicator 2" endpoint="out"/>
		<target step="match ein" endpoint="in_right"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="Multiplicator 2" endpoint="out"/>
		<target step="match fax" endpoint="in_right"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>



<!-- (common-data-problems) --><step id="common-data-problems" className="com.ataccama.dqc.tasks.io.text.read.TextFileReader" disabled="false" mode="NORMAL">
		<properties stringQualifier="&quot;" lineSeparator="\r\n" fieldSeparator=";" lineMaxReadLength="65536" numberOfLinesInHeader="1" fileName="../data/out/common-data-problems.csv" encoding="UTF-8" numberOfLinesInFooter="0" compression="NONE" stringQualifierEscape="&quot;">
			<columns>
				<textReaderColumn name="SalesforceId" type="STRING" ignore="false"/>
				<textReaderColumn name="EIN" type="STRING" ignore="false"/>
				<textReaderColumn name="NPN__c" type="STRING" ignore="false"/>
				<textReaderColumn name="AccountName" type="STRING" ignore="false"/>
				<textReaderColumn name="First_Name__c" type="STRING" ignore="false"/>
				<textReaderColumn name="Middle_Name__c" type="STRING" ignore="false"/>
				<textReaderColumn name="Last_Name__c" type="STRING" ignore="false"/>
				<textReaderColumn name="AccountRecordType" type="STRING" ignore="false"/>
				<textReaderColumn name="BP_ID__c" type="STRING" ignore="false"/>
				<textReaderColumn name="BP_Broker_BoB" type="INTEGER" ignore="false">
					<dataFormatParameters thousandsSeparator="" decimalSeparator="."/>
				</textReaderColumn>
				<textReaderColumn name="AMS_ID__c" type="STRING" ignore="false"/>
				<textReaderColumn name="AMS_Broker_BoB" type="INTEGER" ignore="false">
					<dataFormatParameters thousandsSeparator="" decimalSeparator="."/>
				</textReaderColumn>
				<textReaderColumn name="IBAS_ID__c" type="STRING" ignore="false"/>
				<textReaderColumn name="IBAS_Broker_BoB" type="STRING" ignore="false"/>
				<textReaderColumn name="Closed_Won" type="STRING" ignore="false"/>
				<textReaderColumn name="Weighted_Lives" type="INTEGER" ignore="false">
					<dataFormatParameters thousandsSeparator="" decimalSeparator="."/>
				</textReaderColumn>
				<textReaderColumn name="CRQS_Quotes" type="INTEGER" ignore="false">
					<dataFormatParameters thousandsSeparator="" decimalSeparator="."/>
				</textReaderColumn>
				<textReaderColumn name="Health_Connect_Quotes" type="STRING" ignore="false"/>
				<textReaderColumn name="HealthConnect_Quote_Count" type="INTEGER" ignore="false">
					<dataFormatParameters thousandsSeparator="" decimalSeparator="."/>
				</textReaderColumn>
				<textReaderColumn name="PlatformIntegrationID__c" type="STRING" ignore="false"/>
				<textReaderColumn name="Source_System__c" type="STRING" ignore="false"/>
				<textReaderColumn name="Status__c" type="STRING" ignore="false"/>
				<textReaderColumn name="BillingStreet" type="STRING" ignore="false"/>
				<textReaderColumn name="BillingCity" type="STRING" ignore="false"/>
				<textReaderColumn name="BillingState" type="STRING" ignore="false"/>
				<textReaderColumn name="BillingPostalCode" type="STRING" ignore="false"/>
				<textReaderColumn name="BillingCountry" type="STRING" ignore="false"/>
				<textReaderColumn name="Email__c" type="STRING" ignore="false"/>
				<textReaderColumn name="Phone" type="STRING" ignore="false"/>
				<textReaderColumn name="Mobile__c" type="STRING" ignore="false"/>
				<textReaderColumn name="Home_phone__c" type="STRING" ignore="false"/>
				<textReaderColumn name="Fax" type="STRING" ignore="false"/>
				<textReaderColumn name="AccountOwnerName" type="STRING" ignore="false"/>
				<textReaderColumn name="ParentAccountId" type="STRING" ignore="false"/>
				<textReaderColumn name="ParentAccountName" type="STRING" ignore="false"/>
				<textReaderColumn name="ParentAccountType" type="STRING" ignore="false"/>
				<textReaderColumn name="Region_Benefit__c" type="STRING" ignore="false"/>
				<textReaderColumn name="Market_Benefit__c" type="STRING" ignore="false"/>
				<textReaderColumn name="Office_Benefit__c" type="STRING" ignore="false"/>
				<textReaderColumn name="BSE" type="STRING" ignore="false"/>
				<textReaderColumn name="BSE_Email" type="STRING" ignore="false"/>
				<textReaderColumn name="BSR" type="STRING" ignore="false"/>
				<textReaderColumn name="BSR_Email" type="STRING" ignore="false"/>
				<textReaderColumn name="MarketDirector" type="STRING" ignore="false"/>
				<textReaderColumn name="Market_Director_Email" type="STRING" ignore="false"/>
				<textReaderColumn name="Broker_Class__c" type="STRING" ignore="false"/>
				<textReaderColumn name="VIOLATION" type="STRING" ignore="false"/>
				<textReaderColumn name="VIOLATION_SCORE" type="INTEGER" ignore="false">
					<dataFormatParameters thousandsSeparator="" decimalSeparator="."/>
				</textReaderColumn>
				<textReaderColumn name="VIOLATION_EXP" type="STRING" ignore="false"/>
				<textReaderColumn name="std_email" type="STRING" ignore="false"/>
				<textReaderColumn name="out_email" type="STRING" ignore="false"/>
				<textReaderColumn name="can_id" type="STRING" ignore="false"/>
				<textReaderColumn name="match_id" type="STRING" ignore="false"/>
				<textReaderColumn name="uni_id" type="STRING" ignore="false"/>
				<textReaderColumn name="rule_id" type="STRING" ignore="false"/>
				<textReaderColumn name="uni_can_id" type="STRING" ignore="false"/>
				<textReaderColumn name="uni_cli_id" type="STRING" ignore="false"/>
				<textReaderColumn name="uni_role" type="STRING" ignore="false"/>
				<textReaderColumn name="uni_rule_name" type="STRING" ignore="false"/>
				<textReaderColumn name="uni_group_role" type="STRING" ignore="false"/>
				<textReaderColumn name="out_last_name" type="STRING" ignore="false"/>
				<textReaderColumn name="out_first_name" type="STRING" ignore="false"/>
				<textReaderColumn name="std_AccountName" type="STRING" ignore="false"/>
				<textReaderColumn name="std_First_Name__c" type="STRING" ignore="false"/>
				<textReaderColumn name="std_Middle_Name__c" type="STRING" ignore="false"/>
				<textReaderColumn name="std_Last_Name__c" type="STRING" ignore="false"/>
				<textReaderColumn name="std_EIN" type="STRING" ignore="false"/>
				<textReaderColumn name="std_Phone" type="STRING" ignore="false"/>
				<textReaderColumn name="std_Fax" type="STRING" ignore="false"/>
			</columns>
			<dataFormatParameters trueValue="true" falseValue="false" thousandsSeparator="" dateFormatLocale="en_US" dateTimeFormat="yy-MM-dd HH:mm:ss" decimalSeparator="." dayFormat="yy-MM-dd"/>
			<errorHandlingStrategy rejectFileName="rejected.txt">
				<errorInstructions>
					<errorInstruction putToLog="true" errorType="EXTRA_DATA" dataStrategy="READ_POSSIBLE" putToReject="false"/>
					<errorInstruction putToLog="true" errorType="LONG_LINE" dataStrategy="STOP" putToReject="true"/>
					<errorInstruction putToLog="true" errorType="PROCESSING_ERROR" dataStrategy="STOP" putToReject="false"/>
					<errorInstruction putToLog="true" errorType="INVALID_DATE" dataStrategy="READ_POSSIBLE" putToReject="false"/>
					<errorInstruction putToLog="true" errorType="SHORT_LINE" dataStrategy="READ_POSSIBLE" putToReject="true"/>
					<errorInstruction putToLog="true" errorType="UNPARSABLE_FIELD" dataStrategy="NULL_VALUE" putToReject="false"/>
				</errorInstructions>
			</errorHandlingStrategy>
			<shadowColumns/>
		</properties>
		<visual-constraints bounds="72,48,-1,-1" layout="vertical"/>
	</step>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="common-data-problems" endpoint="out"/>
		<target step="Multiplicator" endpoint="in"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>



<!-- (match ein) --><step id="match ein" className="com.ataccama.dqc.tasks.merge.Join" disabled="false" mode="NORMAL">
		<properties leftKey="std_EIN" matchStrategy="MERGE" rightKey="std_EIN" joinType="LEFT">
			<columnDefinitions>
				<columnDefinition expression="in_left.SalesforceId" name="SalesforceId"/>
				<columnDefinition expression="in_left.Email__c" name="Email__c"/>
				<columnDefinition expression="in_left.Phone" name="Phone"/>
				<columnDefinition expression="in_left.Mobile__c" name="Mobile__c"/>
				<columnDefinition expression="in_left.Fax" name="Fax"/>
				<columnDefinition expression="in_right.SalesforceId" name="ParentAccountId_EIN"/>
				<columnDefinition expression="in_left.std_EIN" name="std_EIN"/>
				<columnDefinition expression="in_left.std_Phone" name="std_Phone"/>
				<columnDefinition expression="in_left.std_Fax" name="std_Fax"/>
				<columnDefinition expression="in_left.std_email" name="std_email"/>
			</columnDefinitions>
		</properties>
		<visual-constraints bounds="72,384,-1,-1" layout="vertical"/>
	</step>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="match ein" endpoint="out"/>
		<target step="match fax" endpoint="in_left"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>



<!-- (match fax) --><step id="match fax" className="com.ataccama.dqc.tasks.merge.Join" disabled="false" mode="NORMAL">
		<properties leftKey="std_Fax" matchStrategy="MERGE" rightKey="std_Fax" joinType="LEFT">
			<columnDefinitions>
				<columnDefinition expression="in_left.SalesforceId" name="SalesforceId"/>
				<columnDefinition expression="in_left.Email__c" name="Email__c"/>
				<columnDefinition expression="in_left.Phone" name="Phone"/>
				<columnDefinition expression="in_left.Mobile__c" name="Mobile__c"/>
				<columnDefinition expression="in_left.Fax" name="Fax"/>
				<columnDefinition expression="in_right.SalesforceId" name="ParentAccountId_Fax"/>
				<columnDefinition expression="in_left.ParentAccountId_EIN" name="ParentAccountId_EIN"/>
				<columnDefinition expression="in_left.std_EIN" name="std_EIN"/>
				<columnDefinition expression="in_left.std_Phone" name="std_Phone"/>
				<columnDefinition expression="in_left.std_Fax" name="std_Fax"/>
				<columnDefinition expression="in_left.std_email" name="std_email"/>
			</columnDefinitions>
		</properties>
		<visual-constraints bounds="72,456,-1,-1" layout="vertical"/>
	</step>
	<connection className="com.ataccama.dqc.model.elements.connections.StandardFlowConnection" disabled="false">
		<source step="match fax" endpoint="out"/>
		<target step="Match  phone" endpoint="in_left"/>
		<visual-constraints>
			<bendpoints/>
		</visual-constraints>
	</connection>



<!-- (out) --><step id="out" className="com.ataccama.dqc.tasks.io.text.write.TextFileWriter" disabled="false" mode="NORMAL">
		<properties useStringQualifierOnAllColumns="false" stringQualifier="&quot;" lineSeparator="\r\n" fieldSeparator=";" generateMetadata="true" fileName="../data/out/agent_agency_matching_using_same_sheet.csv" encoding="UTF-8" writeHeader="true" writeAllColumns="false" compression="NONE" stringQualifierEscape="&quot;">
			<columns>
				<textWriterColumn name="SalesforceId"/>
				<textWriterColumn name="ParentAccountId_email"/>
				<textWriterColumn name="ParentAccountId_phone"/>
				<textWriterColumn name="ParentAccountId_Fax"/>
				<textWriterColumn name="ParentAccountId_EIN"/>
			</columns>
			<dataFormatParameters trueValue="true" falseValue="false" thousandsSeparator="" dateFormatLocale="en_US" dateTimeFormat="yyyy-MM-dd HH:mm:ss" decimalSeparator="." dayFormat="yyyy-MM-dd"/>
		</properties>
		<visual-constraints bounds="72,744,-1,-1" layout="vertical"/>
	</step>

</purity-config>